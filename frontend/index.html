<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Mobile Optimization -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Camera permissions -->
    <meta http-equiv="Permissions-Policy" content="camera=*">
    
    <title>InventoX - Sistema de Invent√°rio</title>
    <!-- Tailwind CSS via CDN (para desenvolvimento) -->
    <!-- TODO: Em produ√ß√£o, compilar Tailwind CSS localmente -->
    <link rel="stylesheet" href="/frontend/dist/styles.css?v=20251111">
    <link rel="stylesheet" href="/frontend/emergency-styles.css" media="screen">
    <!-- ZXing Library - usar vers√£o espec√≠fica em produ√ß√£o -->
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <!-- Configura√ß√£o da aplica√ß√£o -->
    <script src="config.js"></script>
    <style>
        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .toast {
                position: fixed !important;
                top: 20px !important;
                left: 10px !important;
                right: 10px !important;
                z-index: 9999 !important;
                font-size: 16px !important;
            }
            
            /* Prevent zoom on input focus */
            input, select, textarea {
                font-size: 16px !important;
            }
            
            /* Better touch targets */
            button, .btn {
                min-height: 44px !important;
                min-width: 44px !important;
            }
            
            /* Scanner video optimization */
            #scanner video {
                width: 100% !important;
                height: auto !important;
                max-height: 60vh !important;
            }
            
            /* Tab Navigation - Mobile Optimization */
            .tab-navigation {
                overflow-x: auto !important;
                overflow-y: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                scrollbar-width: thin !important;
                scrollbar-color: #cbd5e0 #f7fafc !important;
                display: flex !important;
                flex-wrap: nowrap !important;
                gap: 0 !important;
                position: relative !important;
            }
            
            .tab-navigation::-webkit-scrollbar {
                height: 4px !important;
            }
            
            .tab-navigation::-webkit-scrollbar-track {
                background: #f7fafc !important;
            }
            
            .tab-navigation::-webkit-scrollbar-thumb {
                background: #cbd5e0 !important;
                border-radius: 2px !important;
            }
            
            .tab-btn {
                flex: 0 0 auto !important;
                min-width: 90px !important;
                max-width: none !important;
                padding: 12px 16px !important;
                font-size: 13px !important;
                white-space: nowrap !important;
                border-bottom: 2px solid transparent !important;
                position: relative !important;
                z-index: 1 !important;
                margin: 0 !important;
                box-sizing: border-box !important;
            }
            
            .tab-btn.active {
                border-bottom-color: #3b82f6 !important;
                color: #3b82f6 !important;
                font-weight: 600 !important;
                z-index: 2 !important;
            }
            
            /* Container padding mobile */
            .container {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
            }
            
            /* Garantir que o container das abas n√£o quebra */
            .bg-white.rounded-lg.shadow-md.mb-6 {
                overflow: hidden !important;
            }
        }
        
        /* Global Search Styles */
        .search-filter {
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 9999px;
            border: 1px solid #d1d5db;
            color: #4b5563;
            background-color: white;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .search-filter:hover {
            background-color: #f9fafb;
        }
        
        .search-filter.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .search-filter.active:hover {
            background-color: #2563eb;
        }
        
        .search-suggestion:hover,
        .search-history-item:hover {
            background-color: #eff6ff;
        }
        
        .search-result-item {
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .search-result-item:hover {
            border-color: #93c5fd;
            background-color: #eff6ff;
        }
        
        .search-result-item.selected {
            border-color: #3b82f6;
            background-color: #dbeafe;
        }
        
        /* Voice search animation */
        @keyframes voice-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .voice-active {
            animation: voice-pulse 1s infinite;
        }
        
        /* Scanner Controls Fix */
        .scanner-controls {
            position: relative;
            z-index: 1;
        }
        
        .scanner-controls .flex {
            position: relative;
            z-index: 2;
        }
        
        .scanner-controls input[type="checkbox"] {
            position: relative;
            z-index: 3;
            flex-shrink: 0;
        }
        
        .scanner-controls label,
        .scanner-controls p {
            position: relative;
            z-index: 2;
        }
        
        /* Analytics Styles */
        .chart-period {
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            background-color: white;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chart-period:hover {
            background-color: #f3f4f6;
        }
        
        .chart-period.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .insight-card:hover,
        .recommendation-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Heatmap cells */
        .heatmap-cell {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.2);
            z-index: 10;
        }
        
        /* Chart animations */
        .chart-bar {
            transition: height 0.5s ease-in-out;
        }
        
        .chart-bar:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Enhanced Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-sm mx-4">
            <div class="text-center">
                <!-- Modern Loading Animation -->
                <div class="relative mb-6">
                    <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-100 mx-auto"></div>
                    <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent absolute top-0 left-1/2 transform -translate-x-1/2"></div>
                </div>
                
                <!-- Dynamic Loading Text -->
                <h3 id="loadingTitle" class="text-lg font-semibold text-gray-800 mb-2">A carregar...</h3>
                <p id="loadingMessage" class="text-sm text-gray-600 mb-4">Por favor aguarde</p>
                
                <!-- Progress Bar -->
                <div id="loadingProgress" class="w-full bg-gray-200 rounded-full h-2 hidden">
                    <div id="loadingProgressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 hidden transform translate-x-full transition-transform duration-300">
        <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <div>
                <p id="successToastTitle" class="font-semibold">Sucesso!</p>
                <p id="successToastMessage" class="text-sm opacity-90">Opera√ß√£o conclu√≠da</p>
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div id="errorToast" class="fixed top-4 right-4 bg-red-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 hidden transform translate-x-full transition-transform duration-300">
        <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </div>
            <div>
                <p id="errorToastTitle" class="font-semibold">Erro!</p>
                <p id="errorToastMessage" class="text-sm opacity-90">Algo correu mal</p>
            </div>
        </div>
    </div>

    <!-- Global Search Modal -->
    <div id="globalSearchModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 hidden pt-20">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden">
            
            <!-- Search Header -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-4">
                    <div class="flex-1 relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <input 
                            type="text" 
                            id="globalSearchInput" 
                            class="block w-full pl-10 pr-3 py-3 border-0 text-lg placeholder-gray-500 focus:outline-none focus:ring-0" 
                            placeholder="Pesquisar em tudo... (artigos, sess√µes, utilizadores)"
                            autocomplete="off"
                        >
                    </div>
                    
                    <!-- Voice Search Button -->
                    <button id="voiceSearchBtn" class="p-3 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>
                    </button>
                    
                    <!-- Close Button -->
                    <button id="closeSearchBtn" class="p-3 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Search Filters -->
                <div id="searchFilters" class="mt-4 flex flex-wrap gap-2">
                    <button class="search-filter active" data-filter="all">
                        <span class="text-xs">üîç Tudo</span>
                    </button>
                    <button class="search-filter" data-filter="items">
                        <span class="text-xs">üì¶ Artigos</span>
                    </button>
                    <button class="search-filter" data-filter="sessions">
                        <span class="text-xs">üìã Sess√µes</span>
                    </button>
                    <button class="search-filter" data-filter="users">
                        <span class="text-xs">üë• Utilizadores</span>
                    </button>
                    <button class="search-filter" data-filter="categories">
                        <span class="text-xs">üè∑Ô∏è Categorias</span>
                    </button>
                </div>
            </div>
            
            <!-- Search Content -->
            <div class="flex-1 overflow-y-auto max-h-96">
                
                <!-- Search Suggestions -->
                <div id="searchSuggestions" class="p-4">
                    <div class="text-sm text-gray-500 mb-3">Sugest√µes</div>
                    <div class="space-y-2">
                        <div class="search-suggestion flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer" data-suggestion="stock baixo">
                            <span class="text-gray-400">üîç</span>
                            <span class="text-sm">Artigos com stock baixo</span>
                        </div>
                        <div class="search-suggestion flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer" data-suggestion="sess√µes abertas">
                            <span class="text-gray-400">üîç</span>
                            <span class="text-sm">Sess√µes abertas</span>
                        </div>
                        <div class="search-suggestion flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer" data-suggestion="√∫ltimos scans">
                            <span class="text-gray-400">üîç</span>
                            <span class="text-sm">√öltimos scans realizados</span>
                        </div>
                    </div>
                </div>
                
                <!-- Search Results -->
                <div id="searchResults" class="hidden">
                    <div class="p-4">
                        <div class="text-sm text-gray-500 mb-3">
                            <span id="searchResultsCount">0 resultados</span>
                            <span id="searchResultsTime" class="ml-2 text-gray-400"></span>
                        </div>
                        <div id="searchResultsList" class="space-y-3">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Search History -->
                <div id="searchHistory" class="p-4 border-t border-gray-100">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-sm text-gray-500">Pesquisas Recentes</div>
                        <button id="clearSearchHistory" class="text-xs text-gray-400 hover:text-gray-600">Limpar</button>
                    </div>
                    <div id="searchHistoryList" class="space-y-2">
                        <div class="text-center text-gray-400 py-4 text-sm">
                            Nenhuma pesquisa recente
                        </div>
                    </div>
                </div>
                
                <!-- Voice Search Status -->
                <div id="voiceSearchStatus" class="hidden p-4 bg-blue-50 border-t border-blue-100">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                        <span class="text-sm text-blue-800">A escutar... Fale agora</span>
                        <button id="stopVoiceSearch" class="text-xs text-blue-600 hover:text-blue-800 ml-auto">Parar</button>
                    </div>
                </div>
            </div>
            
            <!-- Search Footer -->
            <div class="p-4 bg-gray-50 border-t border-gray-200">
                <div class="flex items-center justify-between text-xs text-gray-500">
                    <div class="flex items-center space-x-4">
                        <span><kbd class="px-2 py-1 bg-white border rounded">‚Üë‚Üì</kbd> navegar</span>
                        <span><kbd class="px-2 py-1 bg-white border rounded">Enter</kbd> selecionar</span>
                        <span><kbd class="px-2 py-1 bg-white border rounded">Esc</kbd> fechar</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span>Powered by</span>
                        <span class="font-semibold text-blue-600">InventoX Search</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="/frontend/assets/logo.svg" alt="InventoX Logo" class="h-8 w-8" onerror="this.style.display='none'">
                <h1 class="text-xl font-bold">InventoX</h1>
            </div>
            <div class="flex space-x-4 items-center">
                <span id="userInfo" class="text-sm hidden"></span>
                <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded hidden">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Login Screen -->
    <div id="loginSection" class="container mx-auto mt-8 p-4 max-w-md">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>
            <div id="loginError" class="mb-4 text-red-600 text-sm hidden"></div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Username:</label>
                    <input type="text" id="username" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password:</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                </div>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardSection" class="container mx-auto mt-8 p-4 hidden">
        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="tab-navigation flex border-b overflow-x-auto">
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="dashboard">
                    üìä Dashboard
                </button>
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-blue-500 text-blue-600 font-medium whitespace-nowrap active" data-tab="scanner">
                    üì∑ Scanner
                </button>
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="items">
                    üì¶ Artigos
                </button>
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="categories">
                    üè∑Ô∏è Categorias
                </button>
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="sessions">
                    üìã Sess√µes
                </button>
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="import">
                    üì• Importar
                </button>
                <button id="historyTabBtn" class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="history">
                    üìà Hist√≥rico
                </button>
                <button id="analyticsTabBtn" class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap hidden" data-tab="analytics">
                    üìä An√°lise
                </button>
                <button id="usersTabBtn" class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap hidden" data-tab="users">
                    üë• Utilizadores
                </button>
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="companies">
                    üè¢ Empresas
                </button>
                <button class="tab-btn py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="warehouses">
                    üè≠ Armaz√©ns
                </button>
            </div>
        </div>

        <!-- Breadcrumbs Navigation -->
        <div id="breadcrumbs" class="bg-white rounded-lg shadow-sm mb-4 px-4 py-3 hidden">
            <nav class="flex items-center space-x-2 text-sm">
                <span class="text-gray-500">üìç</span>
                <span id="breadcrumbHome" class="text-blue-600 hover:text-blue-800 cursor-pointer font-medium">InventoX</span>
                <span id="breadcrumbSeparator1" class="text-gray-400 hidden">‚Ä∫</span>
                <span id="breadcrumbSection" class="text-gray-600 hidden"></span>
                <span id="breadcrumbSeparator2" class="text-gray-400 hidden">‚Ä∫</span>
                <span id="breadcrumbSubsection" class="text-gray-800 font-medium hidden"></span>
            </nav>
            
            <!-- Keyboard Shortcuts Hint -->
            <div id="keyboardHints" class="mt-2 flex flex-wrap gap-2 text-xs text-gray-500">
                <span class="bg-gray-100 px-2 py-1 rounded">Ctrl+1 Dashboard</span>
                <span class="bg-gray-100 px-2 py-1 rounded">Ctrl+2 Scanner</span>
                <span class="bg-gray-100 px-2 py-1 rounded">Ctrl+3 Artigos</span>
                <span class="bg-gray-100 px-2 py-1 rounded">Ctrl+K Pesquisar</span>
                <span id="hideHintsBtn" class="text-blue-600 hover:text-blue-800 cursor-pointer ml-2">Ocultar</span>
            </div>
        </div>

        <!-- Scanner Tab -->
        <div id="scannerTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-bold mb-4">Scanner de C√≥digo de Barras</h3>
                
                <!-- Camera Controls -->
                <div class="mb-4 flex flex-wrap gap-2">
                    <button id="startScannerBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Iniciar Scanner
                    </button>
                    <button id="stopScannerBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded hidden">
                        Parar Scanner
                    </button>
                    <button id="switchCameraBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded hidden">
                        Trocar C√¢mara
                    </button>
                    <select id="cameraSelect" class="px-3 py-2 border rounded hidden">
                        <option value="">Selecionar C√¢mara</option>
                    </select>
                </div>

                <!-- Enhanced Scanner Controls -->
                <div class="scanner-controls mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="text-sm font-semibold text-blue-800 mb-4">‚öôÔ∏è Configura√ß√µes do Scanner</h4>
                    <div class="space-y-3">
                        <!-- Continuous Scan Mode -->
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="continuousScanMode" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <div>
                                <label for="continuousScanMode" class="text-sm font-medium text-gray-700 cursor-pointer">Modo Cont√≠nuo</label>
                                <p class="text-xs text-gray-500">Digitalizar c√≥digos automaticamente sem parar</p>
                            </div>
                        </div>
                        
                        <!-- Audio Feedback -->
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="audioFeedback" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <div>
                                <label for="audioFeedback" class="text-sm font-medium text-gray-700 cursor-pointer">Som de Confirma√ß√£o</label>
                                <p class="text-xs text-gray-500">Reproduzir som quando um c√≥digo for digitalizado</p>
                            </div>
                        </div>
                        
                        <!-- Auto-focus -->
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="autoFocus" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <div>
                                <label for="autoFocus" class="text-sm font-medium text-gray-700 cursor-pointer">Auto-foco</label>
                                <p class="text-xs text-gray-500">Focar automaticamente a c√¢mara para melhor leitura</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scanner Video -->
                <div id="scanner" class="mb-4 hidden">
                    <div class="relative">
                        <video id="scannerVideo" class="w-full max-w-md mx-auto border rounded" playsinline muted></video>
                        
                        <!-- Scan Overlay -->
                        <div id="scanOverlay" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div class="w-48 h-48 border-2 border-red-500 rounded-lg opacity-50"></div>
                        </div>
                        
                        <!-- Scan Success Animation -->
                        <div id="scanSuccessOverlay" class="absolute inset-0 bg-green-500 bg-opacity-20 flex items-center justify-center hidden">
                            <div class="bg-white rounded-full p-4 shadow-lg">
                                <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Item Preview -->
                <div id="itemPreview" class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg hidden">
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üì¶</span>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h4 id="previewItemName" class="font-semibold text-gray-800">Nome do Item</h4>
                            <p id="previewItemCode" class="text-sm text-gray-600">C√≥digo: ---</p>
                            <p id="previewItemStock" class="text-sm text-gray-600">Stock: ---</p>
                        </div>
                        <div class="flex space-x-2">
                            <button id="confirmScanBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                                Confirmar
                            </button>
                            <button id="cancelScanBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded text-sm">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Scanner Placeholder -->
                <div id="scannerPlaceholder" class="mb-4 p-8 bg-gray-50 rounded-lg text-center border-2 border-dashed border-gray-300">
                    <p class="text-gray-500">Clique em "Iniciar Scanner" para come√ßar a digitalizar c√≥digos de barras</p>
                </div>
                
                <!-- Scanner Status -->
                <div id="scannerStatus" class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-green-800 font-semibold">Scanner Ativo</h4>
                            <p class="text-green-600 text-sm" id="scannerStatusText">Pronto para escanear c√≥digos de barras</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-green-700 text-sm font-medium">Ativo</span>
                        </div>
                    </div>
                </div>

                <!-- Manual Input -->
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ou digite o c√≥digo manualmente:</label>
                    <div class="flex">
                        <input type="text" id="manualBarcode" class="flex-1 px-3 py-2 border rounded-l-lg focus:outline-none focus:border-blue-500" placeholder="C√≥digo de barras">
                        <button id="processManualBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-r-lg">
                            Processar
                        </button>
                    </div>
                </div>

                <!-- Session Selection -->
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Sess√£o Ativa:</label>
                    <select id="sessionSelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="">Selecionar sess√£o...</option>
                    </select>
                </div>

                <!-- Clear Session Button -->
                <div class="mb-4">
                    <button id="clearSessionBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">
                        Limpar Sess√£o
                    </button>
                </div>
            </div>

            <!-- Scan History -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold">Hist√≥rico de Scans</h3>
                    <div class="flex items-center space-x-2">
                        <span id="scanCounter" class="text-sm text-gray-600">0 scans hoje</span>
                        <button id="clearHistoryBtn" class="text-red-600 hover:text-red-800 text-sm">Limpar</button>
                    </div>
                </div>
                
                <div id="scanHistory" class="space-y-2 max-h-48 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">
                        <p class="text-sm">Nenhum scan realizado ainda</p>
                        <p class="text-xs text-gray-400">Os √∫ltimos 10 scans aparecer√£o aqui</p>
                    </div>
                </div>
            </div>

            <!-- Scanned Items -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Itens Digitalizados</h3>
                <div id="scannedItems" class="space-y-2">
                    <!-- Scanned items will appear here -->
                </div>
                <div class="mt-4">
                    <button id="saveCountBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded hidden">
                        Guardar Contagem
                    </button>
                </div>
            </div>
        </div>

        <!-- Items Tab -->
        <div id="itemsTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gest√£o de Artigos</h3>
                    <button id="addItemBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Adicionar Artigo
                    </button>
                </div>
                
                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="itemSearch" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Pesquisar artigos...">
                </div>

                <!-- Items List -->
                <div id="itemsList" class="space-y-2">
                    <!-- Items will be loaded here -->
                </div>
                
                <!-- Items Pagination -->
                <div id="itemsPagination" class="mt-4 flex justify-center">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Sessions Tab -->
        <div id="sessionsTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Sess√µes de Invent√°rio</h3>
                    <button id="createSessionBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Nova Sess√£o
                    </button>
                </div>

                <!-- Sessions List -->
                <div id="sessionsList" class="space-y-2">
                    <!-- Sessions will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Import Tab -->
        <div id="importTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Importar Artigos</h3>
                
                <form id="importForm" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ficheiro Excel (.xlsx):</label>
                        <input type="file" id="importFile" accept=".xlsx,.xls" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <button type="submit" id="uploadBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                        Importar
                    </button>
                </form>

                <div id="importResults" class="mt-4 hidden">
                    <!-- Import results will appear here -->
                </div>
            </div>
        </div>

        <!-- Enhanced Interactive Dashboard -->
        <div id="dashboardTab" class="tab-content hidden">
            
            <!-- Dashboard Controls -->
            <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <h2 class="text-xl font-bold text-gray-800">Dashboard Interativo</h2>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm text-gray-600">Atualiza√ß√£o em tempo real</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button id="refreshDashboard" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm">
                            üîÑ Atualizar
                        </button>
                        <button id="customizeDashboard" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded text-sm">
                            ‚öôÔ∏è Personalizar
                        </button>
                        <button id="resetDashboard" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded text-sm">
                            üîÑ Reset
                        </button>
                    </div>
                </div>
                
                <!-- Quick Stats Bar -->
                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="quickStatScans">0</div>
                        <div class="text-xs text-gray-500">Scans Hoje</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="quickStatSessions">0</div>
                        <div class="text-xs text-gray-500">Sess√µes Ativas</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-600" id="quickStatAlerts">0</div>
                        <div class="text-xs text-gray-500">Alertas</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600" id="quickStatEfficiency">0%</div>
                        <div class="text-xs text-gray-500">Efici√™ncia</div>
                    </div>
                </div>
            </div>

            <!-- Smart Alerts Panel -->
            <div id="smartAlerts" class="mb-6 hidden">
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-yellow-800">üö® Alertas Inteligentes</h3>
                        <button id="dismissAllAlerts" class="text-yellow-600 hover:text-yellow-800 text-sm">Dispensar Todos</button>
                    </div>
                    <div id="alertsList" class="space-y-2">
                        <!-- Dynamic alerts will appear here -->
                    </div>
                </div>
            </div>

            <!-- Customizable Widgets Grid -->
            <div id="widgetsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- KPI Metrics Widget -->
                <div class="widget bg-white rounded-lg shadow-md" data-widget="kpi-metrics">
                    <div class="widget-header p-4 border-b border-gray-200 cursor-move">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">üìä M√©tricas Principais</h3>
                            <div class="flex items-center space-x-2">
                                <button class="widget-refresh text-gray-400 hover:text-gray-600">üîÑ</button>
                                <button class="widget-config text-gray-400 hover:text-gray-600">‚öôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content p-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600" id="statTotalItems">0</div>
                                <div class="text-sm text-gray-500">Total Artigos</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-red-600" id="statLowStock">0</div>
                                <div class="text-sm text-gray-500">Stock Baixo</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600" id="statOpenSessions">0</div>
                                <div class="text-sm text-gray-500">Sess√µes Abertas</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600" id="statInventoryValue">0 CVE</div>
                                <div class="text-sm text-gray-500">Valor Total</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Chart Widget -->
                <div class="widget bg-white rounded-lg shadow-md" data-widget="activity-chart">
                    <div class="widget-header p-4 border-b border-gray-200 cursor-move">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">üìà Atividade Recente</h3>
                            <div class="flex items-center space-x-2">
                                <button class="widget-refresh text-gray-400 hover:text-gray-600">üîÑ</button>
                                <button class="widget-config text-gray-400 hover:text-gray-600">‚öôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content p-4">
                        <div class="h-32 flex items-end justify-between space-x-1">
                            <div class="bg-blue-500 rounded-t" style="height: 60%; width: 12%"></div>
                            <div class="bg-blue-500 rounded-t" style="height: 40%; width: 12%"></div>
                            <div class="bg-blue-500 rounded-t" style="height: 80%; width: 12%"></div>
                            <div class="bg-blue-500 rounded-t" style="height: 30%; width: 12%"></div>
                            <div class="bg-blue-500 rounded-t" style="height: 90%; width: 12%"></div>
                            <div class="bg-blue-500 rounded-t" style="height: 70%; width: 12%"></div>
                            <div class="bg-blue-500 rounded-t" style="height: 50%; width: 12%"></div>
                        </div>
                        <div class="mt-2 text-xs text-gray-500 text-center">√öltimos 7 dias</div>
                    </div>
                </div>

                <!-- Low Stock Alert Widget -->
                <div class="widget bg-white rounded-lg shadow-md" data-widget="low-stock">
                    <div class="widget-header p-4 border-b border-gray-200 cursor-move">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">‚ö†Ô∏è Stock Baixo</h3>
                            <div class="flex items-center space-x-2">
                                <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full" id="lowStockCount">0</span>
                                <button class="widget-refresh text-gray-400 hover:text-gray-600">üîÑ</button>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content p-4">
                        <div id="lowStockList" class="space-y-2 max-h-32 overflow-y-auto">
                            <div class="text-center text-gray-500 py-4">
                                <p class="text-sm">Nenhum item com stock baixo</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Scans Widget -->
                <div class="widget bg-white rounded-lg shadow-md" data-widget="recent-scans">
                    <div class="widget-header p-4 border-b border-gray-200 cursor-move">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">üîç Scans Recentes</h3>
                            <div class="flex items-center space-x-2">
                                <button class="widget-refresh text-gray-400 hover:text-gray-600">üîÑ</button>
                                <button class="widget-config text-gray-400 hover:text-gray-600">‚öôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content p-4">
                        <div id="recentScansList" class="space-y-2 max-h-32 overflow-y-auto">
                            <div class="text-center text-gray-500 py-4">
                                <p class="text-sm">Nenhum scan recente</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Categories Widget -->
                <div class="widget bg-white rounded-lg shadow-md" data-widget="top-categories">
                    <div class="widget-header p-4 border-b border-gray-200 cursor-move">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">üè∑Ô∏è Top Categorias</h3>
                            <div class="flex items-center space-x-2">
                                <button class="widget-refresh text-gray-400 hover:text-gray-600">üîÑ</button>
                                <button class="widget-config text-gray-400 hover:text-gray-600">‚öôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content p-4">
                        <div id="topCategoriesList" class="space-y-2">
                            <div class="text-center text-gray-500 py-4">
                                <p class="text-sm">Carregando categorias...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Widget -->
                <div class="widget bg-white rounded-lg shadow-md" data-widget="performance">
                    <div class="widget-header p-4 border-b border-gray-200 cursor-move">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">‚ö° Performance</h3>
                            <div class="flex items-center space-x-2">
                                <button class="widget-refresh text-gray-400 hover:text-gray-600">üîÑ</button>
                                <button class="widget-config text-gray-400 hover:text-gray-600">‚öôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content p-4">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Scans/Hora</span>
                                <span class="font-semibold" id="scansPerHour">0</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Tempo M√©dio</span>
                                <span class="font-semibold" id="avgScanTime">0s</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Efici√™ncia</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-16 bg-gray-200 rounded-full h-2">
                                        <div id="efficiencyBar" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <span class="text-sm font-semibold" id="efficiencyPercent">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Categories Tab -->
        <div id="categoriesTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gest√£o de Categorias</h3>
                    <button id="createCategoryBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Nova Categoria
                    </button>
                </div>
                
                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="categorySearch" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Pesquisar categorias...">
                </div>

                <!-- Categories List -->
                <div id="categoriesList" class="space-y-2">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="historyTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Hist√≥rico de Movimentos de Stock</h3>
                
                <!-- Filters -->
                <div class="mb-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Tipo:</label>
                        <select id="historyType" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="">Todos</option>
                            <option value="entrada">Entrada</option>
                            <option value="saida">Sa√≠da</option>
                            <option value="ajuste">Ajuste</option>
                            <option value="transferencia">Transfer√™ncia</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Data In√≠cio:</label>
                        <input type="date" id="historyDateFrom" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Data Fim:</label>
                        <input type="date" id="historyDateTo" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="flex items-end">
                        <button onclick="loadStockHistory(1)" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Filtrar
                        </button>
                    </div>
                </div>
                
                <div id="historyList" class="space-y-2">
                    <!-- Stock history will be loaded here -->
                </div>
                
                <div id="historyPagination" class="mt-4 flex justify-center gap-2">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="usersTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gest√£o de Utilizadores</h3>
                    <button id="createUserBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Novo Utilizador
                    </button>
                </div>
                
                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="usersSearch" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Pesquisar utilizadores...">
                </div>

                <!-- Users List -->
                <div id="usersList" class="space-y-2">
                    <!-- Users will be loaded here -->
                </div>
                
                <div id="usersPagination" class="mt-4 flex justify-center gap-2">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Advanced Analytics Tab -->
        <div id="analyticsTab" class="tab-content hidden">
            
            <!-- Analytics Header -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <h2 class="text-2xl font-bold text-gray-800">üìä An√°lise Avan√ßada</h2>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm text-gray-600">Dados em tempo real</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <select id="analyticsTimeRange" class="px-3 py-2 border rounded text-sm">
                            <option value="7">√öltimos 7 dias</option>
                            <option value="30" selected>√öltimos 30 dias</option>
                            <option value="90">√öltimos 90 dias</option>
                            <option value="365">√öltimo ano</option>
                        </select>
                        <button id="refreshAnalytics" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm">
                            üîÑ Atualizar
                        </button>
                        <button id="exportAnalytics" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                            üìä Exportar
                        </button>
                    </div>
                </div>
                
                <!-- Quick KPIs -->
                <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-3xl font-bold text-blue-600" id="kpiTotalScans">0</div>
                        <div class="text-sm text-gray-600">Total de Scans</div>
                        <div class="text-xs text-green-600" id="kpiScansChange">+0%</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-3xl font-bold text-green-600" id="kpiProductivity">0</div>
                        <div class="text-sm text-gray-600">Produtividade</div>
                        <div class="text-xs text-green-600" id="kpiProductivityChange">+0%</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-3xl font-bold text-purple-600" id="kpiAccuracy">0%</div>
                        <div class="text-sm text-gray-600">Precis√£o</div>
                        <div class="text-xs text-green-600" id="kpiAccuracyChange">+0%</div>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <div class="text-3xl font-bold text-orange-600" id="kpiEfficiency">0%</div>
                        <div class="text-sm text-gray-600">Efici√™ncia</div>
                        <div class="text-xs text-green-600" id="kpiEfficiencyChange">+0%</div>
                    </div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                
                <!-- Activity Trend Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">üìà Tend√™ncia de Atividade</h3>
                        <div class="flex items-center space-x-2">
                            <button class="chart-period active" data-period="daily">Di√°rio</button>
                            <button class="chart-period" data-period="weekly">Semanal</button>
                            <button class="chart-period" data-period="monthly">Mensal</button>
                        </div>
                    </div>
                    <div class="h-64 flex items-end justify-between space-x-1" id="activityTrendChart">
                        <!-- Dynamic bars will be generated here -->
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 60%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 40%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 80%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 30%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 90%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 70%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 50%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 85%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 45%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 75%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 65%; width: 8%"></div>
                        <div class="bg-blue-500 rounded-t transition-all duration-300" style="height: 95%; width: 8%"></div>
                    </div>
                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                        <span>H√° 30 dias</span>
                        <span>Hoje</span>
                    </div>
                </div>

                <!-- Performance Heatmap -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">üî• Mapa de Calor - Performance</h3>
                        <button id="heatmapSettings" class="text-gray-400 hover:text-gray-600">‚öôÔ∏è</button>
                    </div>
                    <div class="grid grid-cols-7 gap-1" id="performanceHeatmap">
                        <!-- Heatmap cells will be generated here -->
                    </div>
                    <div class="mt-4 flex items-center justify-between text-xs text-gray-500">
                        <span>Menos ativo</span>
                        <div class="flex items-center space-x-1">
                            <div class="w-3 h-3 bg-gray-200 rounded"></div>
                            <div class="w-3 h-3 bg-green-200 rounded"></div>
                            <div class="w-3 h-3 bg-green-400 rounded"></div>
                            <div class="w-3 h-3 bg-green-600 rounded"></div>
                            <div class="w-3 h-3 bg-green-800 rounded"></div>
                        </div>
                        <span>Mais ativo</span>
                    </div>
                </div>

                <!-- Category Distribution -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">üè∑Ô∏è Distribui√ß√£o por Categoria</h3>
                        <button id="categoryChartType" class="text-sm text-blue-600 hover:text-blue-800">Alternar Vista</button>
                    </div>
                    <div class="h-64 flex items-center justify-center" id="categoryDistributionChart">
                        <!-- Donut chart will be rendered here -->
                        <div class="relative w-48 h-48">
                            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#3b82f6" stroke-width="8" 
                                        stroke-dasharray="75 25" stroke-dashoffset="0"/>
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#10b981" stroke-width="8" 
                                        stroke-dasharray="50 50" stroke-dashoffset="-75"/>
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#f59e0b" stroke-width="8" 
                                        stroke-dasharray="25 75" stroke-dashoffset="-125"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-gray-800">100%</div>
                                    <div class="text-xs text-gray-500">Total</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 space-y-2" id="categoryLegend">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-blue-500 rounded"></div>
                                <span class="text-sm">Eletr√≥nicos</span>
                            </div>
                            <span class="text-sm font-semibold">45%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-500 rounded"></div>
                                <span class="text-sm">Vestu√°rio</span>
                            </div>
                            <span class="text-sm font-semibold">30%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-yellow-500 rounded"></div>
                                <span class="text-sm">Casa & Jardim</span>
                            </div>
                            <span class="text-sm font-semibold">25%</span>
                        </div>
                    </div>
                </div>

                <!-- User Performance Ranking -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">üèÜ Ranking de Utilizadores</h3>
                        <select id="rankingMetric" class="text-sm border rounded px-2 py-1">
                            <option value="scans">Total de Scans</option>
                            <option value="accuracy">Precis√£o</option>
                            <option value="speed">Velocidade</option>
                            <option value="efficiency">Efici√™ncia</option>
                        </select>
                    </div>
                    <div class="space-y-3" id="userRankingList">
                        <div class="flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-yellow-500 text-white rounded-full flex items-center justify-center font-bold text-sm">1</div>
                                <div>
                                    <div class="font-semibold">Jo√£o Silva</div>
                                    <div class="text-xs text-gray-500">Operador</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-yellow-600">1,247</div>
                                <div class="text-xs text-gray-500">scans</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gray-400 text-white rounded-full flex items-center justify-center font-bold text-sm">2</div>
                                <div>
                                    <div class="font-semibold">Maria Santos</div>
                                    <div class="text-xs text-gray-500">Administrador</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-gray-600">892</div>
                                <div class="text-xs text-gray-500">scans</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-orange-50 border border-orange-200 rounded">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold text-sm">3</div>
                                <div>
                                    <div class="font-semibold">Pedro Costa</div>
                                    <div class="text-xs text-gray-500">Operador</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-orange-600">654</div>
                                <div class="text-xs text-gray-500">scans</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Reports Section -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">üìã Relat√≥rios Avan√ßados</h3>
                    <button id="createCustomReport" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded text-sm">
                        ‚ûï Criar Relat√≥rio
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Predefined Reports -->
                    <div class="report-card border border-gray-200 rounded-lg p-4 hover:border-blue-300 cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="text-blue-600 text-lg">üìä</span>
                            </div>
                            <div>
                                <h4 class="font-semibold">Relat√≥rio de Produtividade</h4>
                                <p class="text-xs text-gray-500">An√°lise detalhada de performance</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600">√öltima atualiza√ß√£o: Hoje</span>
                            <button class="text-blue-600 hover:text-blue-800">Gerar</button>
                        </div>
                    </div>
                    
                    <div class="report-card border border-gray-200 rounded-lg p-4 hover:border-green-300 cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-green-600 text-lg">üìà</span>
                            </div>
                            <div>
                                <h4 class="font-semibold">An√°lise de Tend√™ncias</h4>
                                <p class="text-xs text-gray-500">Padr√µes e previs√µes</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600">√öltima atualiza√ß√£o: Ontem</span>
                            <button class="text-green-600 hover:text-green-800">Gerar</button>
                        </div>
                    </div>
                    
                    <div class="report-card border border-gray-200 rounded-lg p-4 hover:border-purple-300 cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                <span class="text-purple-600 text-lg">üéØ</span>
                            </div>
                            <div>
                                <h4 class="font-semibold">Relat√≥rio de Precis√£o</h4>
                                <p class="text-xs text-gray-500">Qualidade e erros</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600">√öltima atualiza√ß√£o: 2 dias</span>
                            <button class="text-purple-600 hover:text-purple-800">Gerar</button>
                        </div>
                    </div>
                    
                    <div class="report-card border border-gray-200 rounded-lg p-4 hover:border-orange-300 cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                <span class="text-orange-600 text-lg">‚è±Ô∏è</span>
                            </div>
                            <div>
                                <h4 class="font-semibold">Relat√≥rio de Tempo</h4>
                                <p class="text-xs text-gray-500">An√°lise temporal detalhada</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600">√öltima atualiza√ß√£o: Hoje</span>
                            <button class="text-orange-600 hover:text-orange-800">Gerar</button>
                        </div>
                    </div>
                    
                    <div class="report-card border border-gray-200 rounded-lg p-4 hover:border-red-300 cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                <span class="text-red-600 text-lg">‚ö†Ô∏è</span>
                            </div>
                            <div>
                                <h4 class="font-semibold">Relat√≥rio de Anomalias</h4>
                                <p class="text-xs text-gray-500">Detec√ß√£o de problemas</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600">√öltima atualiza√ß√£o: Hoje</span>
                            <button class="text-red-600 hover:text-red-800">Gerar</button>
                        </div>
                    </div>
                    
                    <div class="report-card border border-gray-200 rounded-lg p-4 hover:border-indigo-300 cursor-pointer transition-colors">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                                <span class="text-indigo-600 text-lg">üìã</span>
                            </div>
                            <div>
                                <h4 class="font-semibold">Relat√≥rio Personalizado</h4>
                                <p class="text-xs text-gray-500">Configura√ß√£o customizada</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600">Criar novo relat√≥rio</span>
                            <button class="text-indigo-600 hover:text-indigo-800">Configurar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights and Recommendations -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">üí° Insights e Recomenda√ß√µes</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-600">IA Ativa</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- AI Insights -->
                    <div class="space-y-4" id="aiInsights">
                        <div class="insight-card p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-sm">üéØ</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-blue-800 mb-1">Pico de Produtividade</h4>
                                    <p class="text-sm text-blue-700">A produtividade aumenta 23% entre as 10h-12h. Considere agendar tarefas cr√≠ticas neste per√≠odo.</p>
                                    <button class="text-xs text-blue-600 hover:text-blue-800 mt-2">Ver detalhes ‚Üí</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="insight-card p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-sm">üìà</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-green-800 mb-1">Tend√™ncia Positiva</h4>
                                    <p class="text-sm text-green-700">Precis√£o dos scans melhorou 15% na √∫ltima semana. Excelente progresso da equipe!</p>
                                    <button class="text-xs text-green-600 hover:text-green-800 mt-2">Ver detalhes ‚Üí</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="insight-card p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-sm">‚ö†Ô∏è</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-yellow-800 mb-1">Aten√ß√£o Necess√°ria</h4>
                                    <p class="text-sm text-yellow-700">Categoria "Eletr√≥nicos" apresenta 8% mais erros. Revisar processo de digitaliza√ß√£o.</p>
                                    <button class="text-xs text-yellow-600 hover:text-yellow-800 mt-2">Ver detalhes ‚Üí</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recommendations -->
                    <div class="space-y-4" id="aiRecommendations">
                        <div class="recommendation-card p-4 bg-purple-50 border border-purple-200 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-sm">üöÄ</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-purple-800 mb-1">Otimiza√ß√£o Sugerida</h4>
                                    <p class="text-sm text-purple-700">Implementar pausas de 5min a cada hora pode aumentar a produtividade em 12%.</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <button class="text-xs bg-purple-600 text-white px-2 py-1 rounded hover:bg-purple-700">Aplicar</button>
                                        <button class="text-xs text-purple-600 hover:text-purple-800">Mais info</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="recommendation-card p-4 bg-indigo-50 border border-indigo-200 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-sm">üéì</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-indigo-800 mb-1">Forma√ß√£o Recomendada</h4>
                                    <p class="text-sm text-indigo-700">Treino adicional em "C√≥digos de Barras Danificados" pode reduzir erros em 20%.</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <button class="text-xs bg-indigo-600 text-white px-2 py-1 rounded hover:bg-indigo-700">Agendar</button>
                                        <button class="text-xs text-indigo-600 hover:text-indigo-800">Ver curso</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="recommendation-card p-4 bg-teal-50 border border-teal-200 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-teal-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-sm">üîß</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-teal-800 mb-1">Melhoria de Sistema</h4>
                                    <p class="text-sm text-teal-700">Atualizar scanner para modelo XYZ pode aumentar velocidade em 30%.</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <button class="text-xs bg-teal-600 text-white px-2 py-1 rounded hover:bg-teal-700">Or√ßamento</button>
                                        <button class="text-xs text-teal-600 hover:text-teal-800">Especifica√ß√µes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Companies Tab -->
        <div id="companiesTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gest√£o de Empresas</h3>
                    <button id="createCompanyBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Nova Empresa
                    </button>
                </div>
                
                <!-- Companies List -->
                <div id="companiesList" class="space-y-2">
                    <!-- Companies will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Warehouses Tab -->
        <div id="warehousesTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gest√£o de Armaz√©ns</h3>
                    <button id="createWarehouseBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Novo Armaz√©m
                    </button>
                </div>
                
                <!-- Warehouses List -->
                <div id="warehousesList" class="space-y-2">
                    <!-- Warehouses will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Count Setup Modal -->
    <div id="countSetupModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Configurar Contagem</h3>
                    <button onclick="closeCountSetupModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="countSetupForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Empresa <span class="text-red-500">*</span>:</label>
                        <select id="setupCompanySelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                            <option value="">Carregando empresas...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Armaz√©m <span class="text-red-500">*</span>:</label>
                        <select id="setupWarehouseSelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500 bg-gray-100" disabled required>
                            <option value="">Primeiro selecione uma empresa</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Sess√£o:</label>
                        <select id="setupSessionSelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500 bg-gray-100" disabled>
                            <option value="">Primeiro selecione empresa e armaz√©m</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <button type="button" id="setupCreateNewSessionBtn" onclick="toggleNewSessionForm()" class="text-blue-500 hover:text-blue-700 text-sm font-medium hidden">
                            + Criar Nova Sess√£o
                        </button>
                    </div>
                    <div id="setupNewSessionForm" class="mb-4 hidden border-t pt-4">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nome da Sess√£o <span class="text-red-500">*</span>:</label>
                            <input type="text" id="setupSessionName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ex: Invent√°rio Janeiro 2024">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Descri√ß√£o:</label>
                            <textarea id="setupSessionDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3" placeholder="Descri√ß√£o opcional da sess√£o"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeCountSetupModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="button" onclick="confirmCountSetup()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Iniciar Scanner
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Session Details Modal -->
    <div id="sessionDetailsCard" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Detalhes da Sess√£o</h3>
                    <button id="closeSessionDetails" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <div id="sessionDetailsContent">
                    <!-- Session details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Item Info Card -->
    <div id="itemInfoCard" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Informa√ß√µes do Artigo</h3>
                    <button onclick="closeItemInfo()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <div id="itemInfoContent">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">C√≥digo de Barras:</label>
                            <p id="scannerItemBarcode" class="text-gray-900 font-mono">-</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nome do Artigo:</label>
                            <p id="scannerItemName" class="text-gray-900">-</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade Atual:</label>
                            <p id="scannerItemQuantity" class="text-gray-900">-</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade Contada:</label>
                            <input type="number" id="countedQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" min="0" value="0">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">C√≥digo Manual:</label>
                            <input type="text" id="itemCardManualBarcode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Digite o c√≥digo manualmente">
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button onclick="closeItemInfo()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                                Cancelar
                            </button>
                            <button onclick="saveCount()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                                Guardar Contagem
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Count Modal -->
    <div id="editCountModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Editar Contagem</h3>
                    <button onclick="closeEditCountModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="editCountForm" onsubmit="updateCount(event)">
                    <input type="hidden" id="editCountId">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade Contada:</label>
                            <input type="number" id="editCountedQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" min="0" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Notas:</label>
                            <textarea id="editCountNotes" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3" placeholder="Notas adicionais (opcional)"></textarea>
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button type="button" onclick="closeEditCountModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                                Cancelar
                            </button>
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                                Guardar Altera√ß√µes
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modals and Forms (Add Item, Create Session, etc.) -->
    <!-- Add Item Modal -->
    <div id="addItemModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Adicionar Artigo</h3>
                    <button id="closeAddItem" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="addItemForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">C√≥digo de Barras:</label>
                        <input type="text" id="newItemBarcode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome:</label>
                        <input type="text" id="newItemName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descri√ß√£o:</label>
                        <textarea id="newItemDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade:</label>
                        <input type="number" id="newItemQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Pre√ßo Unit√°rio:</label>
                        <input type="number" id="newItemPrice" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0" step="0.01">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Localiza√ß√£o:</label>
                        <input type="text" id="newItemLocation" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelAddItem" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Session Modal -->
    <div id="createSessionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Nova Sess√£o</h3>
                    <button id="closeCreateSession" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="createSessionForm" novalidate>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Empresa <span class="text-red-500">*</span>:</label>
                        <select id="newSessionCompany" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                            <option value="">Carregando empresas...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Armaz√©m <span class="text-red-500">*</span>:</label>
                        <select id="newSessionWarehouse" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500 bg-gray-100" disabled required>
                            <option value="">Primeiro selecione uma empresa</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome da Sess√£o <span class="text-red-500">*</span>:</label>
                        <input type="text" id="newSessionName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descri√ß√£o:</label>
                        <textarea id="newSessionDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelCreateSession" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Criar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="categoryModalTitle" class="text-lg font-bold">Nova Categoria</h3>
                    <button onclick="closeCategoryModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="categoryForm">
                    <input type="hidden" id="categoryId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="categoryName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descri√ß√£o:</label>
                        <textarea id="categoryDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeCategoryModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="userModalTitle" class="text-lg font-bold">Novo Utilizador</h3>
                    <button onclick="closeUserModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="userForm">
                    <input type="hidden" id="userId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Username <span class="text-red-500">*</span>:</label>
                        <input type="text" id="userUsername" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Email <span class="text-red-500">*</span>:</label>
                        <input type="email" id="userEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Password <span id="passwordRequired" class="text-red-500">*</span>:</label>
                        <input type="password" id="userPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Deixe em branco para manter a password atual (ao editar)</p>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Role:</label>
                        <select id="userRole" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="operator">Operador</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="userIsActive" class="mr-2" checked>
                            <span class="text-gray-700 text-sm font-bold">Ativo</span>
                        </label>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeUserModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Company Modal -->
    <div id="companyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="companyModalTitle" class="text-lg font-bold">Nova Empresa</h3>
                    <button onclick="closeCompanyModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="companyForm">
                    <input type="hidden" id="companyId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="companyName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">C√≥digo:</label>
                        <input type="text" id="companyCode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Morada:</label>
                        <textarea id="companyAddress" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="2"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Telefone:</label>
                        <input type="text" id="companyPhone" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                        <input type="email" id="companyEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">NIF:</label>
                        <input type="text" id="companyTaxId" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="companyActive" class="mr-2" checked>
                            <span class="text-gray-700 text-sm font-bold">Ativo</span>
                        </label>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeCompanyModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Warehouse Modal -->
    <div id="warehouseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="warehouseModalTitle" class="text-lg font-bold">Novo Armaz√©m</h3>
                    <button onclick="closeWarehouseModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="warehouseForm">
                    <input type="hidden" id="warehouseId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Empresa <span class="text-red-500">*</span>:</label>
                        <select id="warehouseCompany" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                            <option value="">Selecionar empresa...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="warehouseName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">C√≥digo:</label>
                        <input type="text" id="warehouseCode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Morada:</label>
                        <textarea id="warehouseAddress" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="2"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Localiza√ß√£o:</label>
                        <input type="text" id="warehouseLocation" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="warehouseActive" class="mr-2" checked>
                            <span class="text-gray-700 text-sm font-bold">Ativo</span>
                        </label>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeWarehouseModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Item Modal (for editing) -->
    <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="itemModalTitle" class="text-lg font-bold">Editar Artigo</h3>
                    <button onclick="closeItemModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="itemForm">
                    <input type="hidden" id="itemId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">C√≥digo de Barras <span class="text-red-500">*</span>:</label>
                        <input type="text" id="itemBarcode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="itemName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descri√ß√£o:</label>
                        <textarea id="itemDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Categoria:</label>
                        <select id="itemCategory" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="">Selecionar categoria...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade:</label>
                        <input type="number" id="itemQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade M√≠nima:</label>
                        <input type="number" id="itemMinQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Pre√ßo Unit√°rio:</label>
                        <input type="number" id="itemPrice" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0" step="0.01">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Localiza√ß√£o:</label>
                        <input type="text" id="itemLocation" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Fornecedor:</label>
                        <input type="text" id="itemSupplier" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeItemModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <span id="toastMessage"></span>
    </div>

    <script src="validators.js?v=1.0"></script>
    <script src="app.js?v=1.22"></script>
</body>
</html>